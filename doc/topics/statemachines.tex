\section{State Machines}

% state machines are graphs: nodes as states, edges as possible transitions, each edge is annotated with the set of inputs/events that will trigger a transition, no input/event can be present at more than one outgoing edge on any given node

% mechanics: sequence of inputs/events (either static or dynamic), the system is always in a state, For each consumed input the system transitions to a different state (which might be the same as the previous), some processing may be involved.

\subsection{Parsing}

\subsection{Protocols}

% intro: Starting node, events and transitions, visually spotting problems, documenting protocol commands

Figure \ref{fig:topics:sm:proto} illustrates the state transitions of a simple network protocol.

\begin{figure}[tbp]
  \begin{center}
    \begin{tikzpicture}[remember picture]
      \newcommand{\unit}[0]{24mm}
      \newcommand{\edgeangle}[0]{30}
      \newcommand{\loopiness}[0]{4}
      \newcommand{\startangle}[0]{-1.75}
      \newcommand{\trans}[1]{\scalebox{0.7}{\textsl{\textcolor{purple}{#1}}}}
      
      \tikzstyle{dedge} = [thick,->,>=stealth,draw=black]
      \tikzstyle{node}=[
        overlay,
        draw=black,
        circle, %ellipse,
        thick,
        anchor=center,
        minimum width=24mm,
      ]
      
      % nodes
      \node[node] (disconnected) at (0,0) {Disconnected};
      \node[node] (connected) at ([xshift=\unit] disconnected.east) {Connected};
      \node[node] (authorized) at ([xshift=\unit] connected.east) {Authorized};
      
      % start edge
      \draw[dedge] ([xshift=-\unit/4] disconnected.west) to (disconnected);
      
      % main transitions
      \draw[dedge] (disconnected) to [
        out=\edgeangle, in=180-\edgeangle,
        edge node={node [above] {\trans{accept}}}
      ] (connected);
      \draw[dedge] (connected)    to [
        out=\edgeangle, in=180-\edgeangle,
        edge node={node [above] {\trans{authorize}}}
      ] (authorized);
      \draw[dedge] (authorized)   to [
        out=180+1*\edgeangle, in=-1*\edgeangle,
        edge node={node [below] {\trans{nonce failure}}}
      ] (connected);
      \draw[dedge] (connected)    to [
        out=180+1*\edgeangle, in=-1*\edgeangle,
        edge node={node [below] {\trans{disconnect}}}
      ] (disconnected);
      \draw[dedge] (authorized)   to [
        out=180+1.8*\edgeangle, in=-1.8*\edgeangle,
        edge node={node [below] {\trans{disconnect}}}
      ] (disconnected);
      
      % loop transitions
      \draw[dedge] (authorized) to [
        out=\startangle*\edgeangle+0.5*\edgeangle,
        in=\startangle*\edgeangle+0.0*\edgeangle,
        looseness=\loopiness,
        edge node={node [right] {\trans{service 4}}}
      ] (authorized);
      \draw[dedge] (authorized) to [
        out=\startangle*\edgeangle+1.5*\edgeangle,
        in=\startangle*\edgeangle+1.0*\edgeangle,
        looseness=\loopiness,
        edge node={node [right] {\trans{service 3}}}
      ] (authorized);
      \draw[dedge] (authorized) to [
        out=\startangle*\edgeangle+2.5*\edgeangle,
        in=\startangle*\edgeangle+2.0*\edgeangle,
        looseness=\loopiness,
        edge node={node [right] {\trans{service 2}}}
      ] (authorized);
      \draw[dedge] (authorized) to [
        out=\startangle*\edgeangle+3.5*\edgeangle,
        in=\startangle*\edgeangle+3.0*\edgeangle,
        looseness=\loopiness,
        edge node={node [right] {\trans{service 1}}}
      ] (authorized);
    \end{tikzpicture}
  \end{center}
  \caption[State machine of unnamed protocol]{State machine of unnamed protocol with indicator for start node.}
  \label{fig:topics:sm:proto}
\end{figure}

