\newcommand{\nodetext}[1]{\scalebox{0.7}{#1}}
\newcommand{\hlnodetext}[1]{\nodetext{\textbf{#1}}}
\newcommand{\modalitytext}[1]{\scalebox{0.65}{#1}}
\newcommand{\hlmodalitytext}[1]{\modalitytext{\textbf{#1}}}
\newcommand{\fieldtext}[1]{\scalebox{0.7}{#1}}
\newcommand{\hlfieldtext}[1]{\fieldtext{\textbf{#1}}}
\newcommand{\edgetext}[1]{\scalebox{0.7}{\textit{#1}}}
\newcommand{\hledgetext}[1]{\edgetext{\textbf{#1}}}
\newcommand{\centerspacing}[0]{2.0}
\newcommand{\pointsize}[0]{(8mm)}
\newcommand{\datadist}[0]{(11mm)}
\newcommand{\pointdist}[0]{(\pointsize/2+9mm)}
\newcommand{\roomdist}[0]{(49mm)}
\newcommand{\sqrttwo}[0]{(1.41421356237)}
\newcommand{\diagside}[0]{(0.70710678119)}

\tikzstyle{dedge} = [->,>=stealth,draw=black]
\tikzstyle{dbedge} = [<->,>=stealth,draw=black]
\tikzstyle{node}=[
  overlay,
  circle,
  align=center,
  anchor=center,
]
\tikzstyle{point}=[
  node,
  draw=blue,
  minimum height=\pointsize,
  minimum width=\pointsize,
]
\tikzstyle{room}=[
  node,
  draw=blue,
  minimum height=\pointsize,
  minimum width=\pointsize,
]
\tikzstyle{modality}=[
  node,
  draw=purple,
]
\tikzstyle{unit}=[
  node,
  draw=teal,
  anchor=center,
]
\tikzstyle{data}=[
  node,
  draw=teal,
  anchor=center,
]
\tikzstyle{field}=[
  data,
  rectangle,
  anchor=center,
]
\tikzstyle{highlight}=[
  very thick,
]
\tikzstyle{highlighted-point}=[
  point,
  highlight,
  fill=blue!10,
]
\tikzstyle{highlighted-room}=[
  room,
  highlight,
  fill=blue!10,
]
\tikzstyle{highlighted-modality}=[
  modality,
  highlight,
  fill=purple!10,
]
\tikzstyle{highlighted-unit}=[
  unit,
  highlight,
  fill=teal!10,
]
\tikzstyle{highlighted-data}=[
  data,
  highlight,
  fill=teal!10,
]
\tikzstyle{highlighted-field}=[
  field,
  highlight,
  fill=teal!10,
]

\newcommand{\data}[6]{
  \IfSubStr{#6}{highlight:data}{
    \node[highlighted-data] (#2) at (#3) {\hlnodetext{data}};
    \node[highlighted-field] (hist) at ([yshift=-\datadist,xshift=-1*#1*\datadist] #2.center) {\hlfieldtext{#4}};
    \node[highlighted-field] (live) at ([yshift=-\datadist,xshift= 1*#1*\datadist] #2.center) {\hlfieldtext{#5}};
    \draw[dedge,highlight] (#2) -- (hist) node[midway,sloped,above] {\hledgetext{hist}};
    \draw[dedge,highlight] (#2) -- (live) node[midway,sloped,above] {\hledgetext{live}};
  }{
    \node[data] (#2) at (#3) {\nodetext{data}};
    \node[field] (hist) at ([yshift=-\datadist,xshift=-1*#1*\datadist] #2.center) {\fieldtext{#4}};
    \node[field] (live) at ([yshift=-\datadist,xshift= 1*#1*\datadist] #2.center) {\fieldtext{#5}};
    \draw[dedge] (#2) -- (hist) node[midway,sloped,above] {\edgetext{hist}};
    \draw[dedge] (#2) -- (live) node[midway,sloped,above] {\edgetext{live}};
  }
}
\renewcommand{\unit}[4]{
  \IfSubStr{#4}{highlight:unit}{
    \node[highlighted-unit] (#1) at (#2) {\hlnodetext{\si{#3}}};
  }{
    \node[unit] (#1) at (#2) {\nodetext{\si{#3}}};
  }
}
\newcommand{\point}[8][1]{
  \IfSubStr{#8}{highlight:point}{
    \node[highlighted-point] (#2 point) at (#3) {\hlnodetext{#4}};
  }{
    \node[point] (#2 point) at (#3) {\nodetext{#4}};
  }
  \data{#1}{data}{[yshift=-\pointdist,xshift=-1*#1*\pointdist] #2 point.center}{#6}{#7}{#8};
  \unit{unit}{    [yshift=-\pointdist,xshift=   #1*\pointdist] #2 point.center}{#5}{#8};
  \IfSubStr{#8}{highlight:unit}{
    \draw[dedge,highlight] (#2 point) -- (unit) node[midway,sloped,above] {\hledgetext{unit}};
  }{
    \draw[dedge] (#2 point) -- (unit) node[midway,sloped,above] {\edgetext{unit}};
  }
  \IfSubStr{#8}{highlight:data}{
    \draw[dedge,highlight] (#2 point) -- (data) node[midway,sloped,above] {\hledgetext{data}};
  }{
    \draw[dedge] (#2 point) -- (data) node[midway,sloped,above] {\edgetext{data}};
  }
}

